#
# joyent_base: common ssh configuration options for engineers at Joyent.
#
# Quick-start instructions:
#
# - Review this file.  The comments in this file and the ssh_config(1) manual
#   page should explain what it does.
# - If you already have a $HOME/.ssh/config, append this file to it.  If not,
#   you can copy this file directly to $HOME/.ssh/config.  (Newer versions of
#   OpenSSH also support including a separate file from your main configuration
#   file.)
# - Search below for "USER-SPECIFIC CUSTOMIZATIONS".  Fill out that block with
#   your specific user details and uncomment it.
#
#
# Overview
#
# In general, Joyent engineers may use ssh to connect to a variety of servers,
# including:
#
#   - test machine global zones
#
#   - development zones
#
#   - global zones of production headnodes
#
#   - bastion hosts for other services
#
# Very often, it's convenient to apply some configuration options to a variety
# of hosts whose actual hostnames may have nothing in common (or may not even
# have DNS names).  For example, one usually logs in as "root" for test machine
# global zones, so it's convenient to specify "User root" in the ssh
# configurations for these, but they don't usually have their own DNS names, so
# it may not be obvious how to share configuration.
#
# We accomplish this by defining patterns of hostnames used only in ssh_config.
# For example, a rule like:
#
#     Host *.gz
#         User root
#
# Now we can define blocks for any test machine global zone like:
#
#     Host emy10.gz
#         HostName 172.26.10.4
#
# To ssh to test machine "emy10", we use the hostname "emy10.gz".  That's not a
# real DNS name, but it selects this configuration, which specifies both the IP
# address and the user (by virtue of the "*.gz" configuration block).
#
# We make extensive use of this pattern to define hostnames for test machine
# global zones, dev zones, and production systems.  We define the following
# suffixes:
#
#      *.dev      used for non-global zones used for general development
#      *.gz       used for global zones of development systems
#      *.jpc      used for global zones in JPC (production)
#      *.spc      used for global zones in SPC (production)
#

#
# USER-SPECIFIC CUSTOMIZATIONS
# You probably want to fill in the usernames below and uncomment this block.
#
#Host *.dev
#	# This should be the username you typically use for development systems.
#	User alice
#Host *.jpc *.spc bastion-jpc bastion-spc
#	# This should be your username in the Ops LDAP system.
#	User alice
#Host cr.joyent.us
#	#
#	# This should be your cr.joyent.us username (which is generally your
#	# GitHub username).
#	#
#	User alice


#
# COMMON CONFIGURATIONS
#

#
# *.dev: non-global development zones
#
Host *.dev
	#
	# ssh agent forwarding is convenient so that you can authenticate to
	# remote services (e.g., Manta, GitHub) from remote environments without
	# copying private keys to them.  However, it's not secure to do this in
	# untrusted environments.  It's recommended to keep agent forwarding
	# disabled by default, but enable it for specific trusted systems
	# (including dev systems).
	#
	ForwardAgent yes
	#
	# ServerAliveInterval is helpful when traversing NATs or other devices
	# that may drop TCP connections for inactivity.
	#
	ServerAliveInterval 45

#
# *.gz: global zones in (trusted) development environments
#
Host *.gz
	# In dev environments, logins to global zones usually use user "root".
	User root
	# See the note under "*.dev" above.
	ForwardAgent yes
	# See the note under "*.dev" above.
	ServerAliveInterval 45

#
# *.jpc, *.spc, and bastion hosts: Ops-managed production environments in the
# JPC and SPC.
#
Host *.jpc *.spc bastion-spc bastion-jpc
	#
	# The ControlMaster options are used to persist the ssh connection for
	# these environments to avoid having to re-authenticate for every
	# session.  Care must be taken with these options, precisely because
	# they allow a user of your local system to establish new sessions
	# without re-authenticating.  Remember to disconnect from ssh (and the
	# VPN) when you leave your system unattended.
	#
	ControlMaster auto
	ControlPath "/tmp/ssh-c-%r@%h:%p"
	ControlPersist 300s
	# See the note under "*.dev" above.
	ForwardAgent yes
	# See the note under "*.dev" above.
	ServerAliveInterval 45

Host *.jpc
	#
	# Access JPC and SPC hosts using the Ops-provided bastion hosts. See:
	# https://github.com/joyent/bastion-access-keys
	#
	ProxyCommand ssh bastion-jpc -W %h:%p

Host *.spc
	# See above ("*.jpc").
	ProxyCommand ssh bastion-spc -W %h:%p

Host bastion-jpc
	# TODO this should have a publicly resolvable DNS name.
	Hostname 8.12.45.246

Host bastion-spc
	Hostname east1a-bastion.scloud.zone

#
# SPECIFIC HOSTS: COAL
#

#
# Global zone in a local COAL environment. See
# https://github.com/joyent/triton/blob/master/docs/developer-guide/coal-setup.md.
#
Host coal.gz
	HostName 10.99.99.7


#
# SPECIFIC HOSTS: Emeryville engineering lab
# See https://mo.joyent.com/docs/lab/master/.
#

#
# Nightly test systems
# See https://github.com/joyent/globe-theatre
#
Host nightly-1.gz
	Hostname nightly-1.englab.joyent.us

#
# Engineering staging environment.
# See https://mo.joyent.com/docs/lab/master/staging.html.
#
Host staging-*.gz
	# See the note under "*.jpc" above.
	ControlMaster auto
	ControlPath "/tmp/ssh-c-%r@%h:%p"
	ControlPersist yes

Host staging-1.gz
	Hostname staging-1.englab.joyent.us
Host staging-2.gz
	Hostname staging-2.englab.joyent.us
Host staging-3.gz
	Hostname staging-3.englab.joyent.us

#
# Apollo, Athena, and Zeus are large machines hosting individual KVM-based
# development environments.
#
Host apollo.gz
	Hostname apollo.englab.joyent.us
Host athena.gz
        Hostname athena.englab.joyent.us
Host zeus.gz
        Hostname zeus.englab.joyent.us


#
# SPECIFIC HOSTS: JPC
#
# These are headnodes for production JPC datacenters.
#
Host eu-ams-1.jpc
	HostName ams1-hn.int.joyent.us

Host us-east-1.jpc
	HostName east1-hn.int.joyent.us
Host us-east-2.jpc
	HostName east2-hn.int.joyent.us
Host us-east-3.jpc
	HostName east3-hn.int.joyent.us

Host us-east-3b.jpc
	Hostname east3b-hn.int.joyent.us

Host us-sw-1.jpc
	HostName sw1-hn.int.joyent.us

Host us-west-1.jpc
	HostName west1-hn.int.joyent.us


#
# SPECIFIC HOSTS: SPC
#
# These are headnodes for production SPC datacenters.
#

#
# SPC region: US (aka us-east)
#
Host east1a.spc
	Hostname east1a-hn.scloud.host
Host east1b.spc
	Hostname east1b-hn.scloud.host
Host east1c.spc
	Hostname east1c-hn.scloud.host

#
# SPC region: EU (aka eu-central)
#
Host central1a.spc
	Hostname central1a-hn.scloud.host
Host central1b.spc
	Hostname central1b-hn.scloud.host
Host central1c.spc
	Hostname central1c-hn.scloud.host

#
# SPC region: SG (aka ap-southeast)
#
Host southeast1a.spc
	Hostname southeast1a-hn.scloud.host
Host southeast1b.spc
	Hostname southeast1b-hn.scloud.host
Host southeast1c.spc
	Hostname southeast1c-hn.scloud.host

#
# SPC region: KR (aka ap-northeast)
#
Host northeast1a.spc
	Hostname northeast1a-hn.scloud.host
Host northeast1b.spc
	Hostname northeast1b-hn.scloud.host
Host northeast1c.spc
	Hostname northeast1c-hn.scloud.host

#
# SPC staging environment (non-production)
#
Host staging.spc
	Hostname 10.67.0.20
